<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>IBDWELL</title>
    <script type='application/javascript' src='js/fastclick.js'></script>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="js/amazon-cognito-auth.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js"></script>
    <script src="js/amazon-cognito-identity.min.js"></script>
    <script src="js/config.js"></script>

    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ"
        crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="fonts/Linearicons-Free-v1.0.0/icon-font.min.css">
    <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
    <link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
    <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
    <link rel="stylesheet" type="text/css" href="css/native-interapp.css">
    <link rel="stylesheet" type="text/css" href="css/login-util.css">
    <link rel="stylesheet" type="text/css" href="css/login-main.css">

    <!--
        user-scalable=no doesn't allow users to zoom
        initial-scale=1 means the zoom level when the app is loaded. 1=100%
        maximum-scale=1 means the max zoom level user can zoom
        minimum-scale-1 means the min zoom level user can zoom
        -->
    <!--meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1 
          width=device-width, height=device-height, target-densitydpi=device-dpi, viewport-fit=cover" /-->
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1 
        width=device-width, height=device-height, viewport-fit=cover" />
    <meta http-equiv="Content-Security-Policy" 
        content="default-src * gap://ready file:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
</head>

<body>

    <div class="limiter">
        <div class="container-login100">
            <div class="wrap-login100 p-l-50 p-r-50 p-t-15 p-b-15">
                <form class="login100-form validate-form">
                    <span class="login100-form-title p-b-20">
                        <img src="http://iscc-imgs.s3.amazonaws.com/icons/ibdwell-logo.png">
                    </span>

                    <span class="login100-form-title">
                        <h3 class="h3 mb-3 font-weight-normal" id="titleheader">Register an Account</h3>
                    </span>

                    <div class="wrap-input100 validate-input m-b-16" data-validate="Name is required">
                        <input class="input100" type="text" name="f-name" placeholder="Name" id="nameRegister">
                        <span class="focus-input100"></span>
                        <span class="symbol-input100">
                            <span class="lnr lnr-user"></span>
                        </span>
                    </div>

                    <div class="wrap-input100 validate-input m-b-16" data-validate="Valid email is required: ex@abc.xyz">
                        <input class="input100" type="email" name="email" placeholder="Email" id="emailInputRegister">
                        <span class="focus-input100"></span>
                        <span class="symbol-input100">
                            <span class="lnr lnr-envelope"></span>
                        </span>
                    </div>

                    <div class="wrap-input100 validate-input m-b-16" data-validate="Username is required">
                        <input type="personalname" class="input100" type="text" name="f-name" placeholder="Username" id="personalnameRegister">
                        <span class="focus-input100"></span>
                        <span class="symbol-input100">
                            <span class="lnr lnr-tag"></span>
                        </span>
                    </div>

                    <div class="wrap-input100 validate-input m-b-16" data-validate="Password is required">
                        <input class="input100" type="password" name="password" placeholder="Password" id="passwordInputRegister">
                        <span class="focus-input100"></span>
                        <span class="symbol-input100">
                            <span class="lnr lnr-lock"></span>
                        </span>
                    </div>

                    <div class="wrap-input100 validate-input m-b-16" data-validate="Password is required">
                        <input class="input100" type="password" name="password" placeholder="Confirm Password" id="confirmationpassword">
                        <span class="focus-input100"></span>
                        <span class="symbol-input100">
                            <span class="lnr lnr-lock"></span>
                        </span>

                        <div class="contact101-form-checkbox m-l-5">
                            <input class="input-checkbox100" id="pass-ckb1" type="checkbox" name="password-reveal" onchange="revealPass();">
                            <label class="label-checkbox101" id="pass-ckb2" for="pass-ckb1">
                                <i class="fas fa-eye"></i>
                            </label>
                        </div>
                    </div>

                    <div class="text-center w-full p-t-12 p-b-22">
                        <a class="txt1 bo1 hov1" href="#popup1">
                            <span class="txt1"> Privacy Policy & EULA </span>
                        </a>
                    </div>

                    <div class="contact100-form-checkbox m-l-55">
                        <input class="input-checkbox100" id="priv-ckb1" type="checkbox" name="privacy-agreement" onchange="checkRegisterBtn();">
                        <label class="label-checkbox100 color-grey-dark" for="priv-ckb1">
                            I agree to the Privacy & EULA Notice
                        </label>
                    </div>

                    <div class="container-login100-form-btn p-t-25">
                        <button id="mainbutton" class="login100-form-btn-idle" type="button" onclick="registerButton()" disabled>
                            Register
                        </button>
                    </div>

                    <div class="text-center w-full p-t-42 p-b-22">
                        <a class="txt1 hov1" href="index.html" onclick="cleanSession()"><span class="txt1">
                                <!--i class="fas fa-long-arrow-alt-left"></i-->&#60; Go back to Login
                            </span></a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="popup1" class="overlay">
        <div class="popup">
            <h2>Read our Privacy & EULA Notice</h2>
            <a class="close" href="#">&times;</a>
            <div class="content">
                If you have downloaded and will use this ISCC Mobile Application, it will request, collect and
                store some personal data. We understand that users of this app will either suffer from IBD or be
                associated with somebody that does, so your privacy matters to the ISCC.<br /><br />
                The information contained within our Privacy & EULA Notice defines who we are, what data we collect,
                why we collect it, how we use it, where we store it, how long we keep it, your rights under GDPR
                and how to contact us.<br /><br />
                We encourage you to read this policy and feel free to contact the ISCC with any questions or
                concerns about your privacy practices.<br /><br />
                <a href="privacy-notice.html" class="txt2 bo1 hov1">Click here to read our Privacy & EULA Notice and confirm
                    you have read the Privacy Notice and consent to us collecting and storing
                    your data as listed in the Privacy & EULA Notice.</a><br /><br />
                You can opt out at any time and have some or all of your data, entered through this app, or held
                by the ISCC, deleted.<br />
                <a href="delete-data.html" class="txt2 bo1 hov1">Click here to link to and submit our Data Deletion
                    Form.</a>
            </div>
        </div>
    </div>

    
    <!--Start pop-up form Div -->
    <div id="popup2" class="overlay">
        <div class="popup">
            <h2>Registration Complete!</h2>
            <a class="close" href="index.html" onclick="cleanSession();">&times;</a>

            <div class="content" id="regPopUp">
                <p>Check your email for a verification link.</p>
            </div>
        </div>
    </div>
    <!--End pop-up form Div -->

    <script>
        var name;
        var username;
        var password;
        var personalname;
        var poolData;

        function registerButton() {
			document.getElementById("nameRegister").classList.remove('alert-validate-short');
			document.getElementById("emailInputRegister").classList.remove('alert-validate-short');
			document.getElementById("personalnameRegister").classList.remove('alert-validate-short');
			document.getElementById("passwordInputRegister").classList.remove('alert-validate-short');
			document.getElementById("confirmationpassword").classList.remove('alert-validate-short');

            //actual name
            name = document.getElementById("nameRegister").value;
            //username
            personalname = document.getElementById("personalnameRegister").value;
            //email
            username = document.getElementById("emailInputRegister").value;

            if (document.getElementById("passwordInputRegister").value != document.getElementById("confirmationpassword").value) {
                //alert("Passwords Do Not Match!")
				
				document.getElementById("passwordInputRegister").classList.add('alert-validate-short');
				document.getElementById("confirmationpassword").classList.add('alert-validate-short');
				
				
                throw "Passwords Do Not Match!";
            } else {
                password = document.getElementById("passwordInputRegister").value;
            }

            poolData = {
                UserPoolId: _config.cognito.userPoolId, // Your user pool id here
                ClientId: _config.cognito.clientId // Your client id here
            };

            var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
            var attributeList = [];

            var dataName = {
                Name: 'email',
                Value: name, //get from form field
            };

            var dataEmail = {
                Name: 'email',
                Value: username, //get from form field
            };

            var dataPersonalName = {
                Name: 'name',
                Value: personalname, //get from form field
            };

            var attributeName = new AmazonCognitoIdentity.CognitoUserAttribute(dataName);
            var attributeEmail = new AmazonCognitoIdentity.CognitoUserAttribute(dataEmail);
            var attributePersonalName = new AmazonCognitoIdentity.CognitoUserAttribute(dataPersonalName);

            attributeList.push(attributeName);
            attributeList.push(attributeEmail);
            attributeList.push(attributePersonalName);
            userPool.signUp(username, password, attributeList, null, function (err, result) {
                if (err) {
                    alert(err.message || JSON.stringify(err));
                    return;
                }
                cognitoUser = result.user;
                console.log('user name is ' + cognitoUser.getUsername());
                //change elements of page
                document.getElementById("titleheader").innerHTML = "Check your email for a verification link";
                location.href = "#popup2";

            });
        }
    </script>

    <!-- fast click script -->
    <script>
        if ('addEventListener' in document) {
            document.addEventListener('DOMContentLoaded', function () {
                FastClick.attach(document.body);
            }, false);
        }
    </script>
    <!-- end fast click script -->

    <!-- Start of Jquery script -->
    <script src="vendor/jquery/jquery-3.2.1.min.js"></script>
    <!-- Start of bootstrap script -->
    <script src="vendor/bootstrap/js/popper.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <!-- Start of select script -->
    <script src="vendor/select2/select2.min.js"></script>
    <!-- Start of login main script -->
    <script src="js/login-main.js"></script>

    <script>
        window.onload = function(){
			fillInputFromSess();
			
            //Check privacy notice has been clicked
            if(sessionStorage.getItem("privacyNotice") == "isClicked"){
                //change color of button
                document.getElementById("mainbutton").classList.remove("login100-form-btn-idle");
                document.getElementById("mainbutton").classList.add("login100-form-btn");
                //show checkbox as ticked
                document.getElementById("priv-ckb1").checked = true;
                //allow button to be clickable
                document.getElementById("mainbutton").disabled = !document.getElementById("priv-ckb1").checked;
            }
        }
        
        function checkRegisterBtn(){
            //change color of button
            document.getElementById("mainbutton").classList.remove("login100-form-btn-idle");
            document.getElementById("mainbutton").classList.add("login100-form-btn");
            //allow button to be clickable
            document.getElementById("mainbutton").disabled = !document.getElementById("priv-ckb1").checked;
        }
    </script>

    <script>
        function revealPass(){
            console.log("clicked the third eye");
            if(document.getElementById("pass-ckb1").checked == true){
                document.getElementById("pass-ckb2").innerHTML = "<i class='fas fa-eye-slash'></i>";
                document.getElementById("passwordInputRegister").type = "text";
                document.getElementById("confirmationpassword").type = "text";
            }else{
                document.getElementById("pass-ckb2").innerHTML = "<i class='fas fa-eye'></i>";
                document.getElementById("passwordInputRegister").type = "password";
                document.getElementById("confirmationpassword").type = "password";
            }
        }
    </script>
	
	<script>
		function cleanSession(){
			sessionStorage.clear();
		}
		
		function keepInputInSess(){
			sessionStorage.setItem("regName", document.getElementById("nameRegister").value);
			sessionStorage.setItem("regEmail", document.getElementById("emailInputRegister").value);
			sessionStorage.setItem("regUname", document.getElementById("personalnameRegister").value);
			sessionStorage.setItem("regPass", document.getElementById("passwordInputRegister").value);
			sessionStorage.setItem("regCPass", document.getElementById("confirmationpassword").value);
		}
		
		function fillInputFromSess(){
			document.getElementById("nameRegister").value = sessionStorage.getItem("regName");
			document.getElementById("emailInputRegister").value = sessionStorage.getItem("regEmail");
			document.getElementById("personalnameRegister").value = sessionStorage.getItem("regUname");
			document.getElementById("passwordInputRegister").value = sessionStorage.getItem("regPass");
			document.getElementById("confirmationpassword").value = sessionStorage.getItem("regCPass");
		}
		
		$(window).on('beforeunload', function(event){
			keepInputInSess();
			return;
		});
		
		//$(document).on('ready', function(event){
		//	fillInputFromSess();
		//});
	</script>

</body>

</html>